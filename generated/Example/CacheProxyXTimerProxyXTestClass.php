<?php

//Auto-generated by Weaver - https://github.com/Danack/Weaver
//
//Do not be surprised if any changes to this file are over-written.
namespace Example;

class CacheProxyXTimerProxyXTestClass extends \Example\TimerProxyXTestClass
{

    /**
     * @var \Intahwebz\ObjectCache
     */
    private $cache = null;

    private $timer = null;

    protected $queryString = null;

    public function executeQuery($params)
    {
        $cacheKey = $this->getCacheKey($this->queryString);
                    $cachedValue = $this->cache->get($cacheKey);
                    
                    if ($cachedValue) {
                        echo "Result is in cache.\n";
                        return $cachedValue;
                    }
                    
        $result = parent::executeQuery($params);
        echo "Result was not in cache\n";
                    $this->cache->put($cacheKey, $result, 50);

        return $result;
    }

    public function getCacheKey()
    {
        // TODO - REVERT THIS CRAP.
                // THIS FUNCTION IS MANGLED TO HACK AROUND ZEND CODE NOT 
                // WORKING CORRECTLY. NEED TO UPGRADE TO THE LATEST VERSION AS SOON
                // AS IT'S TAGGED
                $args = func_get_args();
                //Zendcode eats braces
                $cacheKey = '';
                //Zendcode eats braces
                foreach($args as $arg) {
                    //Zendcode eats braces
                    if (is_array($arg)) 
                        foreach ($arg as $argElement) //ugh no brace in attempt to placate zend code
                            $cacheKey = /* wtf*/hash("sha256", $cacheKey.$argElement);
                            //Zendcode eats braces
                        
                        //Zendcode eats braces
                    else 
                        $cacheKey = hash("sha256", $cacheKey.$arg);
                        //Zendcode eats braces
                    
                    //Zendcode eats braces
                }
                //Zendcode eats braces

                return $cacheKey;

                //Zendcode eats braces
    }

    public function __construct($queryString, \Intahwebz\Timer $timer, \Intahwebz\ObjectCache $cache)
    {
        parent::__construct($queryString, $timer);

                $this->cache = $cache;
    }


}
